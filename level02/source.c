# include <stdio.h>
# include <stdlib.h>
# include <string.h>


int main(void) {

	char	buffer1[96]; // rbp-0x70
	char	buffer2[40]; // rbp-0xa0
	char	buffer3[96]; // rbp-0x110
	int		read;
	FILE	*file; // rbp-0x8

	for ( int i = 0; i <= 96; i++ ) {
		buffer1[i] = '\0';
		if ( i <= 40 )
			buffer2[i] = '\0';
		buffer3[i] = '\0';
	}

	if ( (file = fopen("/home/users/level03/.pass", "r")) == NULL ) {
		fwrite( "ERROR: failed to open password file\n", 1, 24, stderr );
		exit( 1 );
	}

	read = fread( buffer2, 1, 41, file );
	buffer2[strcspn(buffer2, "\n")] = '\0';

	if ( read != 41 ) {
		fwrite( "ERROR: failed to read password file\n", 1, 24, stderr );
		fwrite( "ERROR: failed to read password file\n", 1, 24, stderr );
		exit( 1 );
	}

	puts( "===== [ Secure Access System v1.0 ] =====" );
	puts( "/***************************************\\" );
	puts( "| You must login to access this system. |" );
	puts(  "\\**************************************/" );
	printf( "--[ Username: " );
	fgets( buffer1, 100, stdin);
	buffer1[strcspn(buffer1, "\n")] = '\0';
	printf( "--[ Password: " );
	fgets( buffer3, 100, stdin);
	buffer3[strcspn(buffer3, "\n")] = '\0';
	puts( "*****************************************" );

	if ( strncmp(buffer2, buffer3, 41) != 0 ) {
		printf( buffer1 );
		puts( " does not have access!" );
		exit( 1 );
	}

	printf( "Greetings, %s!\n", buffer1 );
	system( "/bin/sh" );

	return 0;

}

// inspect with gdb
// set disassembly-flavor int
// b *0x0000000000400814
// set {char [26]} 0x400bb2 = "/home/users/level02/.pass"
