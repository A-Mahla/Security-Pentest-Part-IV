# include <stdio.h>
# include <stdlib.h>
# include <string.h>


int main(int ac, char **av) {

	(void)ac;
	char *buffer1 = NULL; // 0x8049ab0
	char *buffer2 = NULL; // 0x8049aac
	char buffer3[128];

	while ( 1 ) {

		printf("%p, %p \n", buffer2, buffer1);

		if ( fgets(buffer3, 128, stdin) == 0 )
			break ;
	
		if ( strcmp("auth ", buffer3) == 0 ) {
			buffer2 = malloc(4);
			if ( strlen(buffer3 + 5) < 30 )
				strcpy(buffer2, buffer3);
		}
	
		if ( strcmp("reset", buffer3) == 0 ) {
			free(buffer2);
		}
	
		if ( strcmp("service", buffer3) == 0 ) {
			buffer1 = strdup(buffer3 + 7);
		}
	
		if ( strcmp("login", buffer3) == 0 ) {

			if ( *(buffer2 + 32) != 0 ) {
				system("/bin/sh");
			} else {
				fwrite("Password:\n", 1, 10, stdout);
			}

		}

	}
	
	return (0);

}
